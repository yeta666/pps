<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yeta.pps.mapper.MyRoleMapper">

    <insert id="add" parameterType="com.yeta.pps.vo.RoleVo" useGeneratedKeys="true" keyProperty="id">
        insert into role_${storeId} (name) values (#{name});
    </insert>

    <delete id="delete" parameterType="com.yeta.pps.vo.RoleVo">
        delete from role_${storeId} where id = #{id};
    </delete>

    <update id="update" parameterType="com.yeta.pps.vo.RoleVo">
        update role_${storeId} set name = #{name} where id = #{id};
    </update>

    <select id="findCount" parameterType="com.yeta.pps.vo.RoleVo" resultType="java.lang.Integer">
        select COUNT(0) from role_${storeId};
    </select>

    <select id="findAll" resultType="com.yeta.pps.po.Role">
        select id, name from role_${roleVo.storeId} limit #{pageVo.page}, #{pageVo.pageSize};
    </select>

    <select id="findById" parameterType="com.yeta.pps.vo.RoleVo" resultType="com.yeta.pps.po.Role">
        select id, name from role_${storeId} where id = #{id};
    </select>

    <!---->

    <insert id="addRoleFunction" parameterType="com.yeta.pps.vo.RoleFunctionVo">
        insert into role_function_${storeId} (role_id, function_id) values (#{roleId}, #{functionId});
    </insert>

    <delete id="deleteRoleFunction" parameterType="com.yeta.pps.vo.RoleFunctionVo">
        delete from role_function_${storeId} where role_id = #{roleId};
    </delete>

    <select id="findRoleFunction" parameterType="com.yeta.pps.vo.RoleFunctionVo" resultType="com.yeta.pps.po.Function">
        SELECT
            f.id,
            f.name,
            f.level,
            f.parnet_id
        FROM
            role_${storeId} AS r,
            function AS f,
            role_function_${storeId} AS rf
        WHERE
            r.id = rf.role_id
        AND f.id = rf.function_id
        AND r.id = #{roleId};
    </select>

</mapper>